{{ $path := .Get "dir" }}
{{ $path = strings.TrimSuffix "/" $path }}
{{ $containerId := printf "filetree-%s" ($path | urlize) }}

<div id="{{ $containerId }}">
  {{- partial "filetree.html" (dict "path" (printf "/%s" $path)) -}}
  {{- if not (eq (.Get "zip") "false") -}}
  <p class="filetree-download">
    <a href="#" class="book-btn filetree-download-btn" data-container-id="{{ $containerId }}" data-base-path="{{ $path }}" data-zip-filename="{{ path.Base $path }}.zip">Download as zip</a>
  </p>
  {{- end -}}
</div>

{{- if not (.Page.Scratch.Get "filetree_script_loaded") -}}
  {{- .Page.Scratch.Set "filetree_script_loaded" true -}}
  {{- $script := resources.Get "js/filetree-download.js" -}}
  {{- if $script -}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" integrity="sha512-XMVd28F1oH/O71fzwBnV7HucLxVwtxf26XV8P4wPk26EDxuGZ91N8bsOttmnomcCD3CS5ZMRL50H0GgOHvegtg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="{{ $script.RelPermalink }}"></script>
  {{- else -}}
    {{- errorf "js/filetree-download.js not found in assets directory" -}}
  {{- end -}}
{{- end -}}
